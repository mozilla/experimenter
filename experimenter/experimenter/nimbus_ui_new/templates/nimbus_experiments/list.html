{% extends "common/with_sidebar.html" %}

{% load nimbus_extras %}

{% block title %}
  Nimbus Experiments
{% endblock title %}

{% block sidebar %}
  <form id="filter-form"
        hx-get="{% url "nimbus-new-table" %}"
        hx-trigger="keyup,mouseup delay:100ms"
        hx-target="#experiment-list"
        hx-push-url="true">
    {% for field in filter.form %}{{ field }}{% endfor %}
  </form>
{% endblock sidebar %}

{% block main_content %}
  <div id="experiment-list">
    {% include "nimbus_experiments/table.html" with experiments=experiments page_obj=page_obj filter=filter %}

  </div>
{% endblock main_content %}

{% block extrascripts %}
  {{ block.super }}
  document.body.addEventListener('htmx:afterSwap', function(evt) {
  $('.selectpicker').selectpicker();
  // After reloading the table, we must update the values for status and sort in the sidebar form
  // since it will not have been reloaded in the htmx get call
  const urlParams = new URLSearchParams(window.location.search);
  const sortValue = urlParams.get('sort');
  const statusValue = urlParams.get('status');
  $('#filter-form input[name="status"]').each((i, e) => e.value = statusValue);
  $('#filter-form input[name="sort"]').each((i, e) => e.value = sortValue);
  });
{% endblock %}
