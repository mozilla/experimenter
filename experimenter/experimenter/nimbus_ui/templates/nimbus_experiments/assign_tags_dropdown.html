<div class="dropdown dropup position-static">
  {% include "common/tag_button.html" with tag_count=experiment.tags.count %}

  <div class="dropdown-menu p-2 shadow-sm border rounded-2"
       style="min-width:180px;
              max-height:50vh;
              overflow:auto">
    <strong class="dropdown-header">Assign Tags</strong>
    <form method="post"
          hx-post="{% url 'nimbus-ui-assign-tags' slug=experiment.slug %}"
          hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
          hx-trigger="change"
          hx-target="#assignTagsDropdown, #experiment-tags"
          hx-select="#assignTagsDropdown, #experiment-tags"
          hx-swap="outerHTML"
          hx-on::after-request="document.getElementById('assignTagsDropdown').click()"
          class="m-0">
      {% csrf_token %}
      {% for tag in all_tags %}
        <div class="form-check">
          <input class="form-check-input"
                 type="checkbox"
                 name="tags"
                 id="tag-{{ tag.id }}"
                 value="{{ tag.id }}"
                 {% if tag in experiment.tags.all %}checked{% endif %}>
          <label class="form-check-label d-flex align-items-center"
                 for="tag-{{ tag.id }}">
            <span class="me-1" style="color: {{ tag.color }}">
              <i class="fa-solid fa-circle"></i>
            </span>
            {{ tag.name }}
          </label>
        </div>
      {% empty %}
        <div class="text-center py-2 text-muted">
          <small>No tags available. Create tags first.</small>
        </div>
      {% endfor %}
    </form>
  </div>
</div>
