# Generated by Django 3.2.5 on 2021-10-25 20:14

from django.db import migrations, models


def set_feature_config(apps, schema_editor):
    NimbusExperiment = apps.get_model("experiments", "NimbusExperiment")
    NimbusFeatureConfig = apps.get_model("experiments", "NimbusFeatureConfig")
    applications = {
        "focus-ios": "Focus for iOS",
        "klar-ios": "Klar for iOS",
    }

    for application_slug, application_name in applications.items():
        feature_slug = f"no-feature-{application_slug}"
        feature_name = f"No Feature {application_name}"
        feature_config, _ = NimbusFeatureConfig.objects.get_or_create(
            slug=feature_slug,
            name=feature_name,
            application=application_slug,
            read_only=True,
        )
        NimbusExperiment.objects.filter(application=application_slug).update(
            feature_config=feature_config,
        )


class Migration(migrations.Migration):

    dependencies = [
        ("experiments", "0190_nimbusfeatureconfig_read_only"),
    ]

    operations = [
        migrations.AlterField(
            model_name="nimbusexperiment",
            name="application",
            field=models.CharField(
                choices=[
                    ("firefox-desktop", "Firefox Desktop"),
                    ("fenix", "Firefox for Android (Fenix)"),
                    ("ios", "Firefox for iOS"),
                    ("focus-android", "Focus for Android"),
                    ("klar-android", "Klar for Android"),
                    ("focus-ios", "Focus for iOS"),
                    ("klar-ios", "Klar for iOS"),
                ],
                max_length=255,
            ),
        ),
        migrations.AlterField(
            model_name="nimbusexperiment",
            name="channel",
            field=models.CharField(
                choices=[
                    ("", "No Channel"),
                    ("default", "Unbranded"),
                    ("nightly", "Nightly"),
                    ("beta", "Beta"),
                    ("release", "Release"),
                    ("testflight", "Testflight"),
                ],
                max_length=255,
            ),
        ),
        migrations.AlterField(
            model_name="nimbusfeatureconfig",
            name="application",
            field=models.CharField(
                blank=True,
                choices=[
                    ("firefox-desktop", "Firefox Desktop"),
                    ("fenix", "Firefox for Android (Fenix)"),
                    ("ios", "Firefox for iOS"),
                    ("focus-android", "Focus for Android"),
                    ("klar-android", "Klar for Android"),
                    ("focus-ios", "Focus for iOS"),
                    ("klar-ios", "Klar for iOS"),
                ],
                max_length=255,
                null=True,
            ),
        ),
        migrations.AlterField(
            model_name="nimbusisolationgroup",
            name="application",
            field=models.CharField(
                choices=[
                    ("firefox-desktop", "Firefox Desktop"),
                    ("fenix", "Firefox for Android (Fenix)"),
                    ("ios", "Firefox for iOS"),
                    ("focus-android", "Focus for Android"),
                    ("klar-android", "Klar for Android"),
                    ("focus-ios", "Focus for iOS"),
                    ("klar-ios", "Klar for iOS"),
                ],
                max_length=255,
            ),
        ),
        migrations.RunPython(set_feature_config),
    ]
