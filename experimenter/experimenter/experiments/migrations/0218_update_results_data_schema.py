# Generated by Django 3.2.15 on 2022-10-13 17:50

from django.db import migrations


def update_results_data_schema(apps, schema_editor):
    NimbusExperiment = apps.get_model("experiments", "NimbusExperiment")
    windows = ["daily", "weekly", "overall"]
    for experiment in NimbusExperiment.objects.all():
        data = experiment.results_data
        if data is not None:
            for key, value in data.items():
                if value is not None and key in windows and "all" not in value:
                    data[key] = {}
                    data[key]["all"] = value
                else:
                    data[key] = value

            experiment.results_data = data
            experiment.save()


class Migration(migrations.Migration):

    dependencies = [
        ("experiments", "0217_auto_20220901_1914"),
    ]

    operations = [
        migrations.RunPython(update_results_data_schema),
    ]
