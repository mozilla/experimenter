# Generated by Django 3.1.8 on 2021-04-29 17:22

from django.db import migrations


def set_feature_config(apps, schema_editor):
    NimbusExperiment = apps.get_model("experiments", "NimbusExperiment")
    NimbusFeatureConfig = apps.get_model("experiments", "NimbusFeatureConfig")
    NimbusVersionedSchema = apps.get_model("experiments", "NimbusVersionedSchema")
    application_slug = "monitor-web"
    application_name = "Monitor Web"

    feature_slug = f"no-feature-{application_slug}"
    feature_name = f"No Feature {application_name}"
    feature_config, _ = NimbusFeatureConfig.objects.get_or_create(
        slug=feature_slug, name=feature_name, application=application_slug
    )
    experiments = NimbusExperiment.objects.filter(application=application_slug)
    for experiment in experiments:
        experiment.feature_configs.set([feature_config])

    NimbusVersionedSchema.objects.create(
        feature_config=feature_config,
        version=None,
        sets_prefs=[],
    )


class Migration(migrations.Migration):
    dependencies = [
        ("experiments", "0242_auto_20230804_0032"),
    ]

    operations = [
        migrations.RunPython(set_feature_config),
    ]
