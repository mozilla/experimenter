# Generated by Django 3.2.5 on 2021-08-03 18:32

from django.db import migrations, models


def set_feature_config(apps, schema_editor):
    NimbusExperiment = apps.get_model("experiments", "NimbusExperiment")
    NimbusFeatureConfig = apps.get_model("experiments", "NimbusFeatureConfig")
    applications = {
        "focus-android": "Focus for Android",
        "klar-android": "Klar for Android",
    }

    for application_slug, application_name in applications.items():
        feature_slug = f"no-feature-{application_slug}"
        feature_name = f"No Feature {application_name}"
        feature_config, _ = NimbusFeatureConfig.objects.get_or_create(
            slug=feature_slug, name=feature_name, application=application_slug
        )
        NimbusExperiment.objects.filter(application=application_slug).update(
            feature_config=feature_config
        )


class Migration(migrations.Migration):

    dependencies = [
        ("experiments", "0179_alter_nimbusexperiment_channel"),
    ]

    operations = [
        migrations.AlterField(
            model_name="nimbusexperiment",
            name="application",
            field=models.CharField(
                choices=[
                    ("firefox-desktop", "Firefox Desktop"),
                    ("fenix", "Firefox for Android (Fenix)"),
                    ("ios", "Firefox for iOS"),
                    ("focus-android", "Focus for Android"),
                    ("klar-android", "Klar for Android"),
                ],
                max_length=255,
            ),
        ),
        migrations.AlterField(
            model_name="nimbusfeatureconfig",
            name="application",
            field=models.CharField(
                blank=True,
                choices=[
                    ("firefox-desktop", "Firefox Desktop"),
                    ("fenix", "Firefox for Android (Fenix)"),
                    ("ios", "Firefox for iOS"),
                    ("focus-android", "Focus for Android"),
                    ("klar-android", "Klar for Android"),
                ],
                max_length=255,
                null=True,
            ),
        ),
        migrations.AlterField(
            model_name="nimbusisolationgroup",
            name="application",
            field=models.CharField(
                choices=[
                    ("firefox-desktop", "Firefox Desktop"),
                    ("fenix", "Firefox for Android (Fenix)"),
                    ("ios", "Firefox for iOS"),
                    ("focus-android", "Focus for Android"),
                    ("klar-android", "Klar for Android"),
                ],
                max_length=255,
            ),
        ),
        migrations.RunPython(set_feature_config),
    ]
