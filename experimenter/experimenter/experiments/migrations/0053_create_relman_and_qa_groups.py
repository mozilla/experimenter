# Generated by Django 2.1.7 on 2019-04-25 19:12

from django.db import migrations


def create_permissions(apps, schema_editor):
    Permission = apps.get_model("auth", "Permission")
    ContentType = apps.get_model("contenttypes", "ContentType")
    Experiment = apps.get_model("experiments", "Experiment")

    content_type = ContentType.objects.get_for_model(Experiment)

    qa_permission = Permission.objects.create(
        codename="can_check_QA_signoff",
        name="Can check QA signoff box",
        content_type=content_type,
    )

    relman_permission = Permission.objects.create(
        codename="can_check_relman_signoff",
        name="Can check relman signoff box",
        content_type=content_type,
    )


def remove_permissions(apps, schema_editor):
    Permission = apps.get_model("auth", "Permission")

    relman_signoff = Permission.objects.get(codename="can_check_relman_signoff")
    relman_signoff.delete()

    qa_signoff = Permission.objects.get(codename="can_check_QA_signoff")
    qa_signoff.delete()


def add_groups(apps, schema_editor):

    Group = apps.get_model("auth", "Group")
    Permission = apps.get_model("auth", "Permission")
    ContentType = apps.get_model("contenttypes", "ContentType")
    Experiment = apps.get_model("experiments", "Experiment")

    relman_signoff_group = Group.objects.create(name="Relman Signoff")
    qa_signoff_group = Group.objects.create(name="QA Signoff")

    content_type = ContentType.objects.get_for_model(Experiment)
    relman_permission = Permission.objects.get(
        content_type=content_type, codename="can_check_relman_signoff"
    )
    qa_permission = Permission.objects.get(
        content_type=content_type, codename="can_check_QA_signoff"
    )

    relman_signoff_group.permissions.add(relman_permission)
    qa_signoff_group.permissions.add(qa_permission)


def remove_groups(apps, schema_editor):
    Group = apps.get_model("auth", "Group")

    relman_signoff_group = Group.objects.get(name="Relman Signoff")
    relman_signoff_group.delete()

    qa_signoff_group = Group.objects.get(name="QA Signoff")
    qa_signoff_group.delete()


class Migration(migrations.Migration):

    dependencies = [
        ("experiments", "0052_experiment_risk_security"),
        ("auth", "0009_alter_user_last_name_max_length"),
        ("contenttypes", "0002_remove_content_type_name"),
    ]

    operations = [
        migrations.RunPython(create_permissions, remove_permissions),
        migrations.RunPython(add_groups, remove_groups),
    ]
