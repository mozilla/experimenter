version: "3"

services:
  experimenter:
    image: experimenter:test
    env_file: .env.sample
    environment:
      - DEBUG=False
      - CIRCLE_PULL_REQUEST
      - CIRCLE_BRANCH
    volumes:
      - ./docs/experimenter:/experimenter/experimenter/docs
    links:
      - db

  db:
    restart: always
    image: postgres:14.8
    environment:
      POSTGRES_PASSWORD: postgres

  cirrus:
    env_file: .env.sample
    build:
      context: cirrus/server/
      dockerfile: Dockerfile
    working_dir: /cirrus

  demo-app-server:
    build:
      context: ./demo-app/server
      dockerfile: Dockerfile
    ports:
      - '3002:3002'
    restart: always
  demo-app-frontend:
    build:
      context: ./demo-app/frontend
      dockerfile: Dockerfile
    ports:
      - '8080:80'
    restart: always
