# Generated by Django 3.2.14 on 2022-07-12 21:19

from django.db import migrations


def update_updated_date_time_with_changelog_last_changed_on(apps, schema_editor):
    NimbusExperiment = apps.get_model("experiments", "NimbusExperiment")
    for experiment in NimbusExperiment.objects.all():

        # disabling auto_now
        experiment._meta.get_field("_updated_date_time").auto_now = False

        changes = experiment.changes.all()
        if changes:

            last_changed_on = changes.order_by("-changed_on")[0]
            experiment._updated_date_time = last_changed_on.changed_on
            experiment.save()
        # Re-enabling auto_now
        experiment._meta.get_field("_updated_date_time").auto_now = True


class Migration(migrations.Migration):

    dependencies = [
        ("experiments", "0225_nimbusexperiment__updated_date_time"),
    ]

    operations = [
        migrations.RunPython(update_updated_date_time_with_changelog_last_changed_on),
    ]
