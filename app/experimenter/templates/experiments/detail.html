{% extends "base.html" %}

{% load static %}

{% block breadcrumbs %}
{% endblock %}

{% block content_header %}

  <div class="col-md-9">
    <a class="noanchorstyle spaced-text" href="{% url "experiments-detail" slug=experiment.slug %}">
      {{ experiment.name }}
    </a>
    <span class="badge status-color-{{ experiment.status }}">{{ experiment.get_status_display }}</span>
  </div>


{% endblock %}

{% block content %}
  <div class="row md-mt-20">

    <div class="col-md-9 md-pr-40">

      <div class="row">
        <h4 class="col-md-8 md-mt-0">
          Overview
        </h4>

        {% if experiment.is_editable %}
          <div class="col-md-4 text-right">
            <a class="noanchorstyle" href="{% url "experiments-overview-update" slug=experiment.slug %}"><h5><span class="glyphicon glyphicon-pencil"></span> Edit</h5></a>
          </div>
        {% endif %}
      </div>

      <div class="row card md-pt-15 md-pb-10">
        <div class="col-md-8">
          <p><strong>Owner: {{ experiment.owner }}</strong></p>
        </div>
        <div class="col-md-4 text-right">
          <p><strong>{{ experiment.proposed_start_date }} - {{ experiment.proposed_end_date }}</strong></p>
        </div>
        <div class="col-md-12">
          {{ experiment.short_description|linebreaks }}
        </div>
        {% if experiment.is_begun %}
          <div class="col-md-12 text-center">
            <a class="btn btn-info" href="{{ experiment.test_tube_url }}" target="_blank">
              <span class="glyphicon glyphicon-signal"></span> Test Tube Dashboard
            </a>

            {% if experiment.dashboard_url %}
              <a class="btn btn-info" href="{{ experiment.dashboard_url }}" target="_blank">
                <span class="glyphicon glyphicon-signal"></span> reDash Dashboard
              </a>
            {% endif %}
          </div>
        {% endif %}
      </div>

      <div class="row md-mt-20">
        <h4 class="col-md-8">
          Population
        </h4>

        {% if experiment.is_editable %}
          <div class="col-md-4 text-right">
            <a class="noanchorstyle" href="{% url "experiments-overview-update" slug=experiment.slug %}"><h5><span class="glyphicon glyphicon-pencil"></span> Edit</h5></a>
          </div>
        {% endif %}
      </div>

      <div class="row card md-pt-15 md-pb-10">
        <div class="col-md-12">
          <h4 class="md-mt-0">{{ experiment.population }}</h4>
          {{ experiment.client_matching|linebreaks }}
        </div>
      </div>

      <div class="row md-mt-20">
        <h4 class="col-md-8">
          {% if not experiment.completed_variants %}
            <span class="icon-warning glyphicon glyphicon-exclamation-sign"></span>
          {% endif %}
          Firefox Pref &amp; Branches
        </h4>

        {% if experiment.is_editable %}
          <div class="col-md-4 text-right">
            <a class="noanchorstyle" href="{% url "experiments-variants-update" slug=experiment.slug %}"><h5><span class="glyphicon glyphicon-pencil"></span> Edit</h5></a>
          </div>
        {% endif %}
      </div>

      <div class="row card md-pt-15 md-pb-10">
        {% if experiment.variants.all %}
          {% for variant in experiment.variants.all %}
            <div class="col-md-12 {% if not forloop.last %}md-mb-15{% endif %}">
              <h4 class="md-mt-0">{{ variant.ratio }}% {{ variant.name }}</h4>
              <p><strong>{{ experiment.pref_key }} = <span class="text-info">{{ variant.value }}</span></strong></p>
              <p>{{ variant.description }}</p>

            </div>
          {% endfor %}
        {% else %}

          <p class="col-md-12">You must <a href="{% url "experiments-variants-update" slug=experiment.slug %}">define your branches</a> before you can launch your experiment.</p>
        {% endif %}

      </div>

      <div class="row md-mt-20">
        <h4 class="col-md-8">
          {% if not experiment.completed_objectives %}
            <span class="icon-warning glyphicon glyphicon-exclamation-sign"></span>
          {% endif %}
          Objectives
        </h4>

        {% if experiment.is_editable %}
          <div class="col-md-4 text-right">
            <a class="noanchorstyle" href="{% url "experiments-objectives-update" slug=experiment.slug %}"><h5><span class="glyphicon glyphicon-pencil"></span> Edit</h5></a>
          </div>
        {% endif %}
      </div>

      <div class="row card md-pt-15 md-pb-10">
        <div class="col-md-12">
          {% if experiment.completed_objectives %}
            {{ experiment.objectives|linebreaks }}
          {% else %}
            <p>You must <a href="{% url "experiments-objectives-update" slug=experiment.slug %}">define the objectives</a> before you can launch your experiment.</p>
          {% endif %}
        </div>
      </div>

      <div class="row md-mt-20">
        <h4 class="col-md-8">
          {% if not experiment.completed_objectives %}
            <span class="icon-warning glyphicon glyphicon-exclamation-sign"></span>
          {% endif %}
          Analysis
        </h4>

        {% if experiment.is_editable %}
          <div class="col-md-4 text-right">
            <a class="noanchorstyle" href="{% url "experiments-objectives-update" slug=experiment.slug %}"><h5><span class="glyphicon glyphicon-pencil"></span> Edit</h5></a>
          </div>
        {% endif %}
      </div>

      <div class="row card md-pt-15 md-pb-10">
        <div class="col-md-12">
          {% if experiment.completed_objectives %}
            {{ experiment.analysis|linebreaks }}
          {% else %}

            <p>You must <a href="{% url "experiments-objectives-update" slug=experiment.slug %}">define the analysis plan</a> before you can launch your experiment.</p>
          {% endif %}
        </div>
      </div>

      <div class="row md-mt-20">
        <h4 class="col-md-8">
          {% if not experiment.completed_risks %}
            <span class="icon-warning glyphicon glyphicon-exclamation-sign"></span>
          {% endif %}
          Risk Assessment
        </h4>

        {% if experiment.is_editable %}
          <div class="col-md-4 text-right">
            <a class="noanchorstyle" href="{% url "experiments-risks-update" slug=experiment.slug %}"><h5><span class="glyphicon glyphicon-pencil"></span> Edit</h5></a>
          </div>
        {% endif %}
      </div>

      <div class="row card md-pt-15 md-pb-10">
        <div class="col-md-12">
          {% if experiment.completed_risks %}
            <p>{{ experiment.RISK_PARTNER_RELATED_LABEL }}</p>
            <p class="
              {% if experiment.risk_partner_related %}
                text-danger
              {% endif %}
            ">
              <strong>
                {{ experiment.risk_partner_related|yesno:"Yes,No" }}
              </strong>
            </p>

            <p>{{ experiment.RISK_BRAND_LABEL }}</p>
            <p class="
              {% if experiment.risk_brand %}
                text-danger
              {% endif %}
            ">
              <strong>
                {{ experiment.risk_brand|yesno:"Yes,No" }}
              </strong>
            </p>

            <p>{{ experiment.RISK_FAST_SHIPPED_LABEL }}</p>
            <p class="
              {% if experiment.risk_fast_shipped %}
                text-danger
              {% endif %}
            ">
              <strong>
                {{ experiment.risk_fast_shipped|yesno:"Yes,No" }}
              </strong>
            </p>

            <p>{{ experiment.RISK_CONFIDENTIAL_LABEL }}</p>
            <p class="
              {% if experiment.risk_confidential %}
                text-danger
              {% endif %}
            ">
              <strong>
                {{ experiment.risk_confidential|yesno:"Yes,No" }}
              </strong>
            </p>

            <p>{{ experiment.RISK_RELEASE_POPULATION_LABEL }}</p>
            <p class="
              {% if experiment.risk_release_population %}
                text-danger
              {% endif %}
            ">
              <strong>
                {{ experiment.risk_release_population|yesno:"Yes,No" }}
              </strong>
            </p>

            {% if experiment.is_high_risk %}
              <h5>RASCI Owners and Deliverables</h5>
              {{ experiment.risks|linebreaks }}
            {% endif %}
          {% else %}
            <p>You must <a href="{% url "experiments-risks-update" slug=experiment.slug %}">define the risks</a> before you can launch your experiment.</p>
          {% endif %}
        </div>
      </div>

      <div class="row md-mt-20">
        <h4 class="col-md-8">
          {% if not experiment.completed_risks %}
            <span class="icon-warning glyphicon glyphicon-exclamation-sign"></span>
          {% endif %}
          Testing Plan
        </h4>

        {% if experiment.is_editable %}
          <div class="col-md-4 text-right">
            <a class="noanchorstyle" href="{% url "experiments-risks-update" slug=experiment.slug %}"><h5><span class="glyphicon glyphicon-pencil"></span> Edit</h5></a>
          </div>
        {% endif %}
      </div>

      <div class="row card md-pt-15 md-pb-10">
        <div class="col-md-12">
          {% if experiment.completed_risks %}
            {{ experiment.testing|linebreaks }}
          {% else %}
            <p>You must <a href="{% url "experiments-risks-update" slug=experiment.slug %}">define the QA plan</a> before you can launch your experiment.</p>
          {% endif %}
        </div>
      </div>

    </div>

    <div class="col-md-3">

      {% if experiment.is_draft %}
        {% if experiment.is_ready_for_review %}
          <form
            action="{% url "experiments-status-update" slug=experiment.slug %}"
            method="POST"
          >
            {% csrf_token %}
            <input type="hidden" name="status" value="{{ experiment.STATUS_REVIEW }}" />
            <input
              type="submit"
              class="col-md-12 md-mb-10 btn btn-success"
              value="Submit for Review"
            />
          </form>
        {% else %}
          <input
            type="submit"
            class="col-md-12 md-mb-10 btn btn-success disabled"
            value="Submit for Review"
          />
          <div class="row form-group">
            <div class="col-md-12">
                <p class="help-block">You must complete every section before you can launch this experiment.</p>
            </div>
          </div>
        {% endif %}
      {% endif %}

      {% if experiment.is_in_review %}
        <form
          action="{% url "experiments-status-update" slug=experiment.slug %}"
          method="POST"
          class="md-mb-20"
        >
          {% csrf_token %}
          <input type="hidden" name="status" value="{{ experiment.STATUS_SHIP }}" />
          <input
            type="submit"
            class="col-md-12 md-mb-10 btn btn-success"
            value="Ready to Ship"
          />
        </form>

        <form
          action="{% url "experiments-status-update" slug=experiment.slug %}"
          method="POST"
          class="md-mb-20"
        >
          {% csrf_token %}
          <input type="hidden" name="status" value="{{ experiment.STATUS_DRAFT }}" />
          <input
            type="submit"
            class="col-md-12 md-mb-10 btn btn-warning"
            value="Cancel Review Request"
          />
        </form>
      {% endif %}

      {% if experiment.is_ready_to_ship %}
        <form
          action="{% url "experiments-status-update" slug=experiment.slug %}"
          method="POST"
          class="md-mb-20"
        >
          {% csrf_token %}
          <input type="hidden" name="status" value="{{ experiment.STATUS_REVIEW }}" />
          <input
            type="submit"
            class="col-md-12 md-mb-10 btn btn-warning"
            value="Cancel Ready to Ship"
          />
        </form>
      {% endif %}

      <h5>History</h5>
      {% for change in experiment.ordered_changes %}
        <div class="row help-block">
          <div class="col-md-12">
            <p>{{ change.changed_on.date }}</p>
          </div>
          <hr/>
          <div class="col-md-6">
            <p>{{ change.changed_by }}</p>
          </div>
          <div class="col-md-6 text-right">
            <p>{{ change.pretty_status }}</p>
          </div>
        </div>
      {% endfor %}

    </div>
  </div>
{% endblock %}
