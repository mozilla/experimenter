{
  "$schema": "https://json-schema.org/draft/2019-09/schema",
  "title": "DesktopAllVersionsNimbusExperiment",
  "description": "A Nimbus experiment for Firefox Desktop. This schema is more strict than DesktopNimbusExperiment and is backwards comaptible with Firefox Desktop versions less than 95. It is intended for use inside Experimenter itself.",
  "type": "object",
  "properties": {
    "schemaVersion": {
      "description": "Version of the NimbusExperiment schema this experiment refers to",
      "type": "string"
    },
    "slug": {
      "description": "Unique identifier for the experiment",
      "type": "string"
    },
    "id": {
      "description": "Unique identifier for the experiment. This is a duplicate of slug.",
      "type": "string"
    },
    "appName": {
      "description": "A slug identifying the targeted product of this experiment.",
      "type": "string"
    },
    "appId": {
      "description": "The platform identifier for the targeted app.",
      "type": "string"
    },
    "channel": {
      "description": "A specific channel of an application such as 'nightly',             'beta', or 'release'.",
      "type": "string"
    },
    "userFacingName": {
      "description": "Public name of the experiment displayed on 'about:studies'.",
      "type": "string"
    },
    "userFacingDescription": {
      "description": "Short public description of the experiment.",
      "type": "string"
    },
    "isEnrollmentPaused": {
      "description": "Whether new users should be enrolled into the experiment.",
      "type": "boolean"
    },
    "isRollout": {
      "description": "Whether this experiment is a rollout.",
      "type": "boolean"
    },
    "bucketConfig": {
      "$ref": "#/$defs/ExperimentBucketConfig",
      "description": "Bucketing configuration."
    },
    "outcomes": {
      "description": "List of outcomes relevant to analysis.",
      "items": {
        "$ref": "#/$defs/ExperimentOutcome"
      },
      "type": "array"
    },
    "featureIds": {
      "description": "List of featureIds the experiment includes.",
      "items": {
        "type": "string"
      },
      "type": "array"
    },
    "targeting": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "description": "A JEXL targeting expression."
    },
    "startDate": {
      "anyOf": [
        {
          "format": "date",
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "description": "Actual publish date of the experiment."
    },
    "enrollmentEndDate": {
      "anyOf": [
        {
          "format": "date",
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "description": "Actual enrollment end date."
    },
    "endDate": {
      "anyOf": [
        {
          "format": "date",
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "description": "Actual end date of this experiment."
    },
    "proposedDuration": {
      "description": "Proposed duration of the experiment.",
      "type": "integer"
    },
    "proposedEnrollment": {
      "description": "Number of days expected for new user enrollment.",
      "type": "integer"
    },
    "referenceBranch": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "description": "Slug of the reference branch, if applicable."
    },
    "locales": {
      "anyOf": [
        {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        {
          "type": "null"
        }
      ],
      "description": "List of targeted locale codes."
    },
    "publishedDate": {
      "anyOf": [
        {
          "format": "date-time",
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "description": "First published date to Remote Settings."
    },
    "localizations": {
      "anyOf": [
        {
          "$ref": "#/$defs/ExperimentLocalizations"
        },
        {
          "type": "null"
        }
      ],
      "description": "Per-locale localization substitutions."
    },
    "branches": {
      "description": "Branch configuration for the experiment.",
      "items": {
        "$ref": "#/$defs/DesktopAllVersionsExperimentBranch"
      },
      "type": "array"
    },
    "isFirefoxLabsOptIn": {
      "description": "Whether this experiment is a Firefox Labs Opt-In.",
      "type": "boolean"
    },
    "firefoxLabsGroup": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "description": "The group this should appear under in Firefox Labs"
    },
    "firefoxLabsTitle": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "description": "The title shown in Firefox Labs (Fluent ID)"
    },
    "firefoxLabsDescription": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "description": "The description shown in Firefox Labs (Fluent ID)"
    },
    "firefoxLabsDescriptionLinks": {
      "anyOf": [
        {
          "additionalProperties": {
            "format": "uri",
            "maxLength": 2083,
            "minLength": 1,
            "type": "string"
          },
          "type": "object"
        },
        {
          "type": "null"
        }
      ],
      "description": "Links that will be used with the Firefox Labs             description Fluent ID."
    },
    "featureValidationOptOut": {
      "description": "Opt out of feature schema validation.",
      "type": "boolean"
    },
    "requiresRestart": {
      "description": "Does the experiment require a restart to take effect?",
      "type": "boolean"
    }
  },
  "required": [
    "schemaVersion",
    "slug",
    "id",
    "appName",
    "appId",
    "channel",
    "userFacingName",
    "userFacingDescription",
    "isEnrollmentPaused",
    "bucketConfig",
    "startDate",
    "endDate",
    "proposedEnrollment",
    "referenceBranch",
    "branches"
  ],
  "dependentSchemas": {
    "isFirefoxLabsOptIn": {
      "if": {
        "properties": {
          "isFirefoxLabsOptIn": {
            "const": true
          }
        }
      },
      "then": {
        "if": {
          "properties": {
            "isRollout": {
              "const": false
            }
          },
          "required": [
            "isRollout"
          ]
        },
        "required": [
          "firefoxLabsDescription",
          "firefoxLabsDescriptionLinks",
          "firefoxLabsGroup",
          "firefoxLabsTitle"
        ],
        "then": {
          "properties": {
            "branches": {
              "items": {
                "required": [
                  "firefoxLabsTitle"
                ]
              }
            }
          }
        }
      }
    }
  },
  "$defs": {
    "DesktopAllVersionsExperimentBranch": {
      "description": "The branch definition supported on all Firefox Desktop versions. This version requires the feature field to be present to support older Firefox Desktop clients.",
      "properties": {
        "slug": {
          "description": "Identifier for the branch.",
          "type": "string"
        },
        "ratio": {
          "description": "Relative ratio of population for the branch. e.g., if branch A=1 and branch B=3, then branch A                 would get 25% of the population.",
          "type": "integer"
        },
        "features": {
          "description": "An array of feature configurations.",
          "items": {
            "$ref": "#/$defs/ExperimentFeatureConfig"
          },
          "type": "array"
        },
        "firefoxLabsTitle": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "description": "The branch title shown in Firefox Labs (Fluent ID)"
        },
        "feature": {
          "$ref": "#/$defs/DesktopPre95FeatureConfig",
          "description": "The feature key must be provided with values to prevent crashes if the experiment is encountered by Desktop clients earlier than version 95."
        }
      },
      "required": [
        "slug",
        "ratio",
        "features",
        "feature"
      ],
      "type": "object"
    },
    "DesktopPre95FeatureConfig": {
      "properties": {
        "featureId": {
          "const": "this-is-included-for-desktop-pre-95-support",
          "type": "string"
        },
        "value": {
          "type": "object"
        },
        "enabled": {
          "const": false,
          "type": "boolean"
        }
      },
      "required": [
        "featureId",
        "value",
        "enabled"
      ],
      "type": "object"
    },
    "ExperimentBucketConfig": {
      "description": "Common Bucketing Configuration used across all versions.",
      "properties": {
        "randomizationUnit": {
          "$ref": "#/$defs/RandomizationUnit"
        },
        "namespace": {
          "description": "Additional inputs to the hashing function.",
          "type": "string"
        },
        "start": {
          "description": "Index of the starting bucket of the range.",
          "type": "integer"
        },
        "count": {
          "description": "Number of buckets in the range.",
          "type": "integer"
        },
        "total": {
          "description": "The total number of buckets. You can assume             this will always be 10000.",
          "type": "integer"
        }
      },
      "required": [
        "randomizationUnit",
        "namespace",
        "start",
        "count",
        "total"
      ],
      "type": "object"
    },
    "ExperimentFeatureConfig": {
      "properties": {
        "featureId": {
          "description": "The identifier for the feature flag.",
          "type": "string"
        },
        "value": {
          "description": "The values that define the feature configuration.",
          "type": "object"
        }
      },
      "required": [
        "featureId",
        "value"
      ],
      "type": "object"
    },
    "ExperimentLocalizations": {
      "additionalProperties": {
        "additionalProperties": {
          "type": "string"
        },
        "type": "object"
      },
      "description": "Per-locale localization substitutions. The top level key is the locale (e.g., \"en-US\" or \"fr\"). Each entry is a mapping of string IDs to their localized equivalents.",
      "type": "object"
    },
    "ExperimentOutcome": {
      "properties": {
        "slug": {
          "description": "Identifier for the outcome.",
          "type": "string"
        },
        "priority": {
          "description": "e.g., \"primary\" or \"secondary\".",
          "type": "string"
        }
      },
      "required": [
        "slug",
        "priority"
      ],
      "type": "object"
    },
    "RandomizationUnit": {
      "description": "A unique, stable identifier for the user used as an input to bucket hashing.",
      "enum": [
        "normandy_id",
        "nimbus_id",
        "user_id",
        "group_id"
      ],
      "type": "string"
    }
  }
}
